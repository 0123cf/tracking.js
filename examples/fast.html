<!doctype html>

<html>
<head>
  <title>tracking.js - fast algorithm</title>

  <meta charset="utf-8">

  <script src="../build/tracking.js"></script>
</head>
<body>
  <canvas id="canvas"></canvas>
  <script>
    var CornerTracker = function() {
      CornerTracker.base(this, 'constructor');
    };

    tracking.inherits(CornerTracker, tracking.Tracker);

    CornerTracker.prototype.track = function(pixels, width, height) {
      var grayScale = new Uint8ClampedArray(width * height),
        position = 0,
        w = 0;

      for (var i = 0; i < height; i++) {
        for (var j = 0; j < width; j++) {
          grayScale[position++] = pixels[w]*0.299 + pixels[w + 1]*0.587 + pixels[w + 2]*0.114;
          w += 4;
        }
      }

      var timeNow = new Date().getTime();
      var corners = tracking.Fast.findCorners(grayScale, width, height);
      console.log('time:', new Date().getTime() - timeNow);

      this.onFound(corners);
    };

    var canvas = tracking.one('#canvas');
    var context = canvas.getContext('2d');

    tracking.Canvas.loadImage(canvas, 'assets/book1.png', 0, 0, 320, 240, function() {
      var tracker = new CornerTracker();
      tracker.onFound = function(corners) {
        for (var i = 0; i < corners.length; i += 2) {
          context.fillStyle = "rgb(255,0,0)";
          context.fillRect(corners[i], corners[i+1], 1, 1);
        }
      };

      tracking.track('#canvas', tracker);
    });
  </script>
</body>
</html>
