/**
 * tracking.js - Augmented Reality JavaScript Framework.
 * @author Eduardo Lundgren <edu@rdo.io>
 * @version v1.0.0-alpha
 * @link http://trackingjs.com
 * @license BSD
 */
!function(r){r.tracking=r.tracking||{},tracking.forEach=function(r,t,n){var a;if(Array.isArray(r))r.forEach(function(){t.apply(n,arguments)});else for(a in r)r.hasOwnProperty(a)&&t.call(n,r[a],a,r);return r},tracking.inherits=function(r,t){function n(){}n.prototype=t.prototype,r.superClass_=t.prototype,r.prototype=new n,r.prototype.constructor=r,r.base=function(r,n){var a=Array.prototype.slice.call(arguments,2);return t.prototype[n].apply(r,a)}},tracking.initUserMedia_=function(t,n){r.navigator.getUserMedia({video:!0,audio:n.audio},function(n){try{t.src=r.URL.createObjectURL(n)}catch(a){t.src=n}},function(){throw Error("Cannot capture user camera.")})},tracking.isNode=function(r){return r.nodeType||this.isWindow(r)},tracking.isWindow=function(r){return!!(r&&r.alert&&r.document)},tracking.merge=function(r,t){for(var n in t)r[n]=t[n];return r},tracking.one=function(r,t){return this.isNode(r)?r:(t||document).querySelector(r)},tracking.track=function(r,t,n){if(r=tracking.one(r),!r)throw new Error("Element not found, try a different element or selector.");if(!t)throw new Error("Tracker not specified, try `tracking.track(element, new tracking.FaceTracker())`.");switch(r.nodeName.toLowerCase()){case"canvas":return this.trackCanvas_(r,t,n);case"img":return this.trackImg_(r,t,n);case"video":return n&&n.camera&&this.initUserMedia_(r,n),this.trackVideo_(r,t,n);default:throw new Error("Element not supported, try in a canvas, img, or video.")}},tracking.trackCanvas_=function(r,t){var n=r.width,a=r.height,i=r.getContext("2d"),e=i.getImageData(0,0,n,a);t.track(e.data,n,a)},tracking.trackImg_=function(r,t){var n=r.width,a=r.height,i=document.createElement("canvas");i.width=n,i.height=a,tracking.Canvas.loadImage(i,r.src,0,0,n,a,function(){tracking.trackCanvas_(i,t)})},tracking.trackVideo_=function(t,n){var a=document.createElement("canvas"),i=a.getContext("2d"),e=t.offsetWidth,o=t.offsetHeight;a.width=e,a.height=o,r.requestAnimationFrame(function(){t.readyState===t.HAVE_ENOUGH_DATA&&(i.drawImage(t,0,0,e,o),tracking.trackCanvas_(a,n)),tracking.trackVideo_(t,n)})},r.URL||(r.URL=r.URL||r.webkitURL||r.msURL||r.oURL),navigator.getUserMedia||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)}(window),function(){tracking.Brief={},tracking.Brief.N=128,tracking.Brief.randomOffsets_={},tracking.Brief.getDescriptors=function(r,t,n){for(var a=new Int32Array(n.length*(this.N>>5)),i=0,e=this.getRandomOffsets_(t),o=0,c=0;c<n.length;c+=2)for(var s=t*n[c+1]+n[c],g=0,k=this.N;k>g;g++)r[e[g+g]+s]<r[e[g+g+1]+s]&&(i|=1<<(31&g)),g+1&31||(a[o++]=i,i=0);return a},tracking.Brief.match=function(r,t,n,a){for(var i=r.length>>1,e=n.length>>1,o=new Int32Array(i),c=0;i>c;c++){for(var s=1/0,g=0,k=0;e>k;k++){for(var u=0,f=0,h=this.N>>5;h>f;f++)u+=tracking.Math.hammingWeight(t[c*h+f]^a[k*h+f]);s>u&&(s=u,g=k)}o[c]=g}return o},tracking.Brief.getRandomOffsets_=function(r){if(this.randomOffsets_[r])return this.randomOffsets_[r];for(var t=new Int32Array(2*this.N),n=0,a=0;a<this.N;a++)t[n++]=tracking.Math.uniformRandom(-15,16)*r+tracking.Math.uniformRandom(-15,16),t[n++]=tracking.Math.uniformRandom(-15,16)*r+tracking.Math.uniformRandom(-15,16);return this.randomOffsets_[r]=t,this.randomOffsets_[r]}}(),function(){tracking.Canvas={},tracking.Canvas.loadImage=function(r,t,n,a,i,e,o){var c=this,s=new window.Image;s.onload=function(){var t=r.getContext("2d");r.width=i,r.height=e,t.drawImage(s,n,a,i,e),o&&o.call(c),s=null},s.src=t}}(),function(){tracking.EPnP={},tracking.EPnP.solve=function(){}}(),function(){tracking.ViolaJones={},tracking.ViolaJones.REGIONS_OVERLAP=.5,tracking.ViolaJones.BLOCK_SIZE=20,tracking.ViolaJones.BLOCK_JUMP=2,tracking.ViolaJones.BLOCK_SCALE=1.25,tracking.ViolaJones.detect=function(r,t,n,a){for(var i=Math.round,e=tracking.Matrix.computeIntergralImage(r,t,n),o=e[0],c=e[1],s=this.BLOCK_SIZE,g=1/this.BLOCK_SIZE,k=Math.min(t,n),u=0,f=[];k>=s;s=i(s*this.BLOCK_SCALE))for(var h=1/(s*s),l=s*g,d=n-s,v=t-s,p=i(this.BLOCK_JUMP*l),y=0;d>y;y+=p)for(var m=0;v>m;m+=p)this.evalStages_(a,o,c,y,m,t,s,l,h)&&(f[u++]={size:s,x:m,y:y});return this.mergeRectangles_(f)},tracking.ViolaJones.evalStages_=function(r,t,n,a,i,e,o,c,s){var g=a*e+i,k=a*e+(i+o),u=(a+o)*e+i,f=(a+o)*e+(i+o),h=t[g]-t[k]-t[u]+t[f],l=n[g]-n[k]-n[u]+n[f],d=h*s,v=l*s-d*d;v=v>1?Math.sqrt(v):1;for(var p=r.length,y=0;p>y;){for(var m=0,C=r[y++],T=r[y++];T--;){for(var _=0,w=r[y++],A=0;w>A;A++){var M=i+Math.round(r[y++]*c),E=a+Math.round(r[y++]*c),R=Math.round(r[y++]*c),I=Math.round(r[y++]*c),O=r[y++],x=M+R,F=E+I,L=E*e+M,S=E*e+x,D=F*e+M,U=F*e+x;_+=(t[L]-t[S]-t[D]+t[U])*O}var z=r[y++],N=r[y++],B=r[y++];m+=z*v>_*s?N:B}if(C>=m)return!1}return!0},tracking.ViolaJones.mergeRectangles_=function(r){for(var t=new tracking.DisjointSet(r.length),n=0;n<r.length;n++)for(var a=r[n],i=0;i<r.length;i++){var e=r[i];if(tracking.Math.intersectRect(a.x,a.y,a.x+a.size,a.y+a.size,e.x,e.y,e.x+e.size,e.y+e.size)){var o=Math.max(a.x,e.x),c=Math.max(a.y,e.y),s=Math.min(a.x+a.size,e.x+e.size),g=Math.min(a.y+a.size,e.y+e.size),k=(o-s)*(c-g),u=a.size*a.size,f=e.size*e.size;k/(u*(u/f))>=this.REGIONS_OVERLAP&&k/(f*(u/f))>=this.REGIONS_OVERLAP&&t.union(n,i)}}for(var h={},l=0;l<t.length;l++){var d=t.find(l);h[d]?(h[d].count++,h[d].size+=r[l].size,h[d].x+=r[l].x,h[d].y+=r[l].y):h[d]={count:1,size:r[l].size,x:r[l].x,y:r[l].y}}var v=[];return Object.keys(h).forEach(function(r){var t=h[r];v.push({size:t.size/t.count,x:t.x/t.count,y:t.y/t.count})}),v}}(),function(){tracking.Fast={},tracking.Fast.FAST_THRESHOLD=40,tracking.Fast.circles_={},tracking.Fast.findCorners=function(r,t,n){for(var a=this.getCircleOffsets_(t),i=new Int32Array(16),e=[],o=3;n-3>o;o++)for(var c=3;t-3>c;c++){for(var s=o*t+c,g=r[s],k=0;16>k;k++)i[k]=r[s+a[k]];this.isCorner(g,i,this.FAST_THRESHOLD)&&(e.push(c,o),c+=3)}return e},tracking.Fast.isBrighter=function(r,t,n){return r-t>n},tracking.Fast.isCorner=function(r,t,n){var a,i,e;if(this.isTriviallyExcluded(t,r,n))return!1;for(var o=0;16>o;o++){e=!0,a=!0;for(var c=0;9>c;c++)i=t[o+c&15],this.isBrighter(r,i,n)||(a=!1),this.isDarker(r,i,n)||(e=!1)}return a||e},tracking.Fast.isDarker=function(r,t,n){return t-r>n},tracking.Fast.isTriviallyExcluded=function(r,t,n){var a=0,i=r[8],e=r[12],o=r[4],c=r[0];return this.isBrighter(c,t,n)&&a++,this.isBrighter(o,t,n)&&a++,this.isBrighter(i,t,n)&&a++,this.isBrighter(e,t,n)&&a++,3>a&&(a=0,this.isDarker(c,t,n)&&a++,this.isDarker(o,t,n)&&a++,this.isDarker(i,t,n)&&a++,this.isDarker(e,t,n)&&a++,3>a)?!0:!1},tracking.Fast.getCircleOffsets_=function(r){if(this.circles_[r])return this.circles_[r];var t=new Int32Array(16);return t[0]=-r-r-r,t[1]=t[0]+1,t[2]=t[1]+r+1,t[3]=t[2]+r+1,t[4]=t[3]+r,t[5]=t[4]+r,t[6]=t[5]+r-1,t[7]=t[6]+r-1,t[8]=t[7]-1,t[9]=t[8]-1,t[10]=t[9]-r-1,t[11]=t[10]-r-1,t[12]=t[11]-r,t[13]=t[12]-r,t[14]=t[13]-r+1,t[15]=t[14]-r+1,this.circles_[r]=t,t}}(),function(){tracking.Image={},tracking.Image.calculateLumaGrayscale=function(r,t,n){for(var a=new Uint8ClampedArray(t*n),i=0,e=0,o=0;n>o;o++)for(var c=0;t>c;c++)a[i++]=.299*r[e]+.587*r[e+1]+.114*r[e+2],e+=4;return a}}(),function(){tracking.Math={},tracking.Math.distance=function(r,t,n,a){var i=n-r,e=a-t;return Math.sqrt(i*i+e*e)},tracking.Math.hammingWeight=function(r){return r-=r>>1&1431655765,r=(858993459&r)+(r>>2&858993459),16843009*(r+(r>>4)&252645135)>>24},tracking.Math.uniformRandom=function(r,t){return r+Math.random()*(t-r)},tracking.Math.intersectRect=function(r,t,n,a,i,e,o,c){return!(i>n||r>o||e>a||t>c)}}(),function(){tracking.Matrix={},tracking.Matrix.forEach=function(r,t,n,a,i){var e,o=i||1,c=0,s=0;for(c=0;n>c;c+=o)for(s=0;t>s;s+=o)e=c*t*4+4*s,a.call(this,r[e],r[e+1],r[e+2],r[e+3],e,c,s)},tracking.Matrix.computeIntergralImage=function(r,t,n){for(var a=new Int32Array(t*n),i=new Int32Array(t*n),e=0,o=0,c=0,s=0;n>s;s++)for(var g=0;t>g;g++){var k=s*t*4+4*g,u=~~(.299*r[k]+.587*r[k+1]+.114*r[k+2]);0===s&&0===g?(o=u,c=u*u):0===s?(o=u+a[s*t+(g-1)],c=u*u+i[s*t+(g-1)]):0===g?(o=u+a[(s-1)*t+g],c=u*u+i[(s-1)*t+g]):(o=u+a[s*t+(g-1)]+a[(s-1)*t+g]-a[(s-1)*t+(g-1)],c=u*u+i[s*t+(g-1)]+i[(s-1)*t+g]-i[(s-1)*t+(g-1)]),a[e]=o,i[e]=c,e++}return[a,i]}}(),function(){tracking.DisjointSet=function(r){if(void 0===r)throw new Error("DisjointSet length not specified.");this.length=r,this.parent=new Uint32Array(r);for(var t=0;r>t;t++)this.parent[t]=t},tracking.DisjointSet.prototype.length=null,tracking.DisjointSet.prototype.parent=null,tracking.DisjointSet.prototype.find=function(r){return this.parent[r]===r?r:this.parent[r]=this.find(this.parent[r])},tracking.DisjointSet.prototype.union=function(r,t){var n=this.find(r),a=this.find(t);this.parent[n]=a}}(),function(){tracking.Tracker=function(){},tracking.Tracker.prototype.onFound=function(){},tracking.Tracker.prototype.onNotFound=function(){},tracking.Tracker.prototype.track=function(){}}(),function(){tracking.HAARTracker=function(){tracking.HAARTracker.base(this,"constructor")},tracking.inherits(tracking.HAARTracker,tracking.Tracker),tracking.HAARTracker.data={},tracking.Tracker.prototype.data=null,tracking.Tracker.prototype.getData=function(){return this.data},tracking.HAARTracker.prototype.track=function(r,t,n){var a=this.getData();if(!a)throw new Error("HAAR cascade data not set.");var i=tracking.ViolaJones.detect(r,t,n,a);i.length?this.onFound&&this.onFound.call(this,i):this.onNotFound&&this.onNotFound.call(this,i)},tracking.Tracker.prototype.setData=function(r){this.data=r}}(),function(){tracking.ColorTracker=function(){tracking.ColorTracker.base(this,"constructor"),this.setColors(["magenta"])},tracking.inherits(tracking.ColorTracker,tracking.Tracker),tracking.ColorTracker.MIN_PIXELS=30,tracking.ColorTracker.knownColors_={},tracking.ColorTracker.registerColor=function(r,t){tracking.ColorTracker.knownColors_[r]=t},tracking.ColorTracker.getColor=function(r){return tracking.ColorTracker.knownColors_[r]},tracking.ColorTracker.prototype.colors=null,tracking.ColorTracker.prototype.calculateCentralCoordinate_=function(r,t){for(var n=0,a=0,i=-1,e=-1,o=1/0,c=1/0,s=0,g=0;t>g;g+=2){var k=r[g],u=r[g+1];k>-1&&u>-1&&(n+=k,a+=u,s++,o>k&&(o=k),k>i&&(i=k),c>u&&(c=u),u>e&&(e=u))}return 0===s?null:{x:n/s,y:a/s,z:60-(i-o+(e-c))/2}},tracking.ColorTracker.prototype.flagOutliers_=function(r,t){for(var n=0;t>n;n+=2){for(var a=0,i=2;t>i;i+=2)a+=tracking.Math.distance(r[n],r[n+1],r[i],r[i+1]);a/t>=tracking.ColorTracker.MIN_PIXELS&&(r[n]=-1,r[n+1]=-1,t[n]--)}},tracking.ColorTracker.prototype.getColors=function(){return this.colors},tracking.ColorTracker.prototype.setColors=function(r){this.colors=r},tracking.ColorTracker.prototype.track=function(r,t,n){var a,i,e,o=this,c=this.getColors(),s=[],g=[],k=[];for(tracking.Matrix.forEach(r,t,n,function(r,t,n,g,u,f,h){for(e=-1;a=c[++e];)s[e]||(k[e]=0,s[e]=[]),i=tracking.ColorTracker.knownColors_[a],i&&i.call(o,r,t,n,g,u,f,h)&&(k[e]+=2,s[e].push(h,f))}),e=-1;a=c[++e];)if(!(k[e]<tracking.ColorTracker.MIN_PIXELS)){o.flagOutliers_(s[e],k[e]);var u=o.calculateCentralCoordinate_(s[e],k[e]);u&&(u.color=c[e],u.pixels=s[e],g.push(u))}g.length?o.onFound&&o.onFound.call(o,g):o.onNotFound&&o.onNotFound.call(o,g)},tracking.ColorTracker.registerColor("cyan",function(r,t,n){var a=50,i=70,e=r-0,o=t-255,c=n-255;return t-r>=a&&n-r>=i?!0:Math.sqrt(e*e+o*o+c*c)<80}),tracking.ColorTracker.registerColor("magenta",function(r,t,n){var a=50,i=r-255,e=t-0,o=n-255;return r-t>=a&&n-t>=a?!0:Math.sqrt(i*i+e*e+o*o)<140}),tracking.ColorTracker.registerColor("yellow",function(r,t,n){var a=50,i=r-255,e=t-255,o=n-0;return r-t>=a&&n-t>=a?!0:Math.sqrt(i*i+e*e+o*o)<100})}(),function(){tracking.EyeTracker=function(){tracking.EyeTracker.base(this,"constructor");var r=tracking.HAARTracker.data.eye;r&&this.setData(new Float64Array(r))},tracking.inherits(tracking.EyeTracker,tracking.HAARTracker)}(),function(){tracking.FaceTracker=function(){tracking.FaceTracker.base(this,"constructor");var r=tracking.HAARTracker.data.face;r&&this.setData(new Float64Array(r))},tracking.inherits(tracking.FaceTracker,tracking.HAARTracker)}(),function(){tracking.MouthTracker=function(){tracking.MouthTracker.base(this,"constructor");var r=tracking.HAARTracker.data.mouth;r&&this.setData(new Float64Array(r))},tracking.inherits(tracking.MouthTracker,tracking.HAARTracker)}();